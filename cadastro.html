<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eco Acesso - Cadastro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Reset e estilos gerais */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --verde-principal: #2e7d32;
            --verde-escuro: #1b5e20;
            --verde-claro: #4caf50;
            --verde-muito-claro: #c8e6c9;
            --verde-super-claro: #e8f5e9;
            --branco: #ffffff;
            --cinza-claro: #f5f5f5;
            --cinza-escuro: #424242;
            --amarelo: #ffeb3b;
            --laranja: #ff9800;
            --azul: #2196f3;
            --marrom-claro: #d7ccc8;
            --marrom: #8d6e63;
        }

        body {
            background: linear-gradient(135deg, var(--verde-super-claro), var(--verde-muito-claro));
            color: var(--cinza-escuro);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1.5rem;
        }

        /* Container principal centralizado - MAIS LARGO */
        .main-container {
            width: 100%;
            max-width: 900px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* CABEÇALHO ATUALIZADO - Design para BANNER */
        header {
            /* Mantém o fundo para caso o banner não carregue */
            background: linear-gradient(135deg, #3e8e41, #2e7d32, #1b5e20);
            color: var(--branco);
            padding: 0;
            /* REMOVIDO: Padding para o banner preencher */
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            border-radius: 18px;
            margin-bottom: 2rem;
            width: 100%;
            text-align: center;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* ESTILO PARA O BANNER */
        .header-banner {
            width: 100%;
            /* Ocupa a largura total do header */
            height: auto;
            /* Mantém a proporção */
            display: block;
        }

        /* Título da página */
        .page-title {
            text-align: center;
            margin-bottom: 1.8rem;
            color: var(--verde-escuro);
            width: 100%;
        }

        .page-title h1 {
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .page-title p {
            font-size: 1.1rem;
            color: var(--cinza-escuro);
        }

        /* Layout do formulário - MAIS LARGO */
        .form-wrapper {
            width: 100%;
            background-color: var(--branco);
            border-radius: 16px;
            padding: 2.5rem;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .form-wrapper::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, var(--verde-claro), var(--verde-principal), var(--verde-escuro));
        }

        /* Layout de colunas para formulário mais largo */
        .form-columns {
            display: flex;
            gap: 1.5rem;
        }

        .form-column {
            flex: 1;
        }

        /* Estilos do formulário */
        .form-section {
            margin-bottom: 1.8rem;
        }

        .form-section h3 {
            color: var(--verde-principal);
            margin-bottom: 1.2rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--verde-muito-claro);
            display: flex;
            align-items: center;
            font-size: 1.2rem;
        }

        .form-section h3 i {
            margin-right: 10px;
            font-size: 1.2rem;
        }

        .form-group {
            margin-bottom: 1.2rem;
            position: relative;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--cinza-escuro);
            font-size: 0.95rem;
        }

        .required::after {
            content: " *";
            color: #d32f2f; /* Vermelho mais forte para obrigatório */
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 0.9rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
            background-color: var(--branco);
        }

        input:focus,
        select:focus,
        textarea:focus {
            border-color: var(--verde-claro);
            outline: none;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.2);
        }

        input.error,
        select.error,
        textarea.error {
            border-color: #f44336;
            box-shadow: 0 0 0 3px rgba(244, 67, 54, 0.2);
        }

        .error-message {
            color: #f44336;
            font-size: 0.8rem;
            margin-top: 0.3rem;
            display: none;
        }

        .checkbox-group {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
            margin-bottom: 0.8rem;
        }

        .checkbox-group input {
            width: auto;
            margin-top: 0.2rem;
        }

        .checkbox-group label {
            margin-bottom: 0;
            font-size: 0.95rem;
        }

        button {
            background: linear-gradient(135deg, var(--verde-principal), var(--verde-escuro));
            color: var(--branco);
            border: none;
            padding: 1.2rem 2.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s;
            font-weight: 600;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 12px rgba(46, 125, 50, 0.3);
            margin-top: 1.5rem;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(46, 125, 50, 0.4);
        }

        button:active {
            transform: translateY(-1px);
        }

        button:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Mensagens de sucesso/erro */
        .message {
            padding: 1.2rem;
            border-radius: 8px;
            margin-bottom: 1.8rem;
            display: none;
            animation: fadeIn 0.5s ease;
            width: 100%;
            text-align: center;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.success {
            background-color: #e8f5e9;
            border-left: 4px solid var(--verde-claro);
            color: var(--verde-escuro);
        }

        .message.error {
            background-color: #ffebee;
            border-left: 4px solid #f44336;
            color: #c62828;
        }

        /* Rodapé */
        footer {
            background: linear-gradient(135deg, var(--verde-escuro), var(--verde-principal));
            color: var(--branco);
            text-align: center;
            padding: 1.2rem;
            margin-top: 1.8rem;
            border-radius: 12px;
            width: 100%;
            font-size: 0.9rem;
        }

        /* Utilitários */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, .3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .success-checkmark {
            display: inline-block;
            width: 20px;
            height: 20px;
            background-color: transparent;
            /* Fundo transparente, apenas o ícone */
        }

        /* Ícone de check do Font Awesome para sucesso */
        .success-checkmark i {
            font-size: 20px;
            line-height: 1;
        }


        .cep-loading {
            position: absolute;
            right: 12px;
            top: 38px;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(76, 175, 80, 0.3);
            border-radius: 50%;
            border-top-color: var(--verde-claro);
            animation: spin 1s ease-in-out infinite;
            display: none;
        }

        /* Barra de progresso */
        .progress-container {
            width: 100%;
            margin-bottom: 1.8rem;
        }

        .progress-bar {
            height: 8px;
            background-color: var(--verde-muito-claro);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background: linear-gradient(90deg, var(--verde-claro), var(--verde-principal));
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        .progress-text {
            text-align: center;
            font-size: 0.9rem;
            color: var(--verde-escuro);
            margin-top: 0.5rem;
        }

        /* Indicador de CEP válido */
        .cep-valid {
            position: absolute;
            right: 12px;
            top: 38px;
            color: var(--verde-claro);
            display: none;
        }

        /* Campos lado a lado */
        .form-row {
            display: flex;
            gap: 1rem;
        }

        .form-row .form-group {
            flex: 1;
        }

        /* Responsividade para telas menores */
        @media (max-width: 768px) {
            .form-columns {
                flex-direction: column;
                gap: 0;
            }

            .form-row {
                flex-direction: column;
                gap: 0;
            }

            .main-container {
                max-width: 100%;
            }

            .form-wrapper {
                padding: 1.8rem;
            }

            header {
                padding: 0;
            }
        }

        @media (max-width: 480px) {
            .form-wrapper {
                padding: 1.5rem;
            }

            header {
                padding: 0;
            }
        }
    </style>
    <link rel="icon" href="ecoacesso.ico" type="image/x-icon">
</head>

<body>
    <div class="main-container">
        <header>
            <!-- Substitua 'banner.jpeg' por um URL de placeholder se você não tiver a imagem -->
            <img src="banner.jpeg"
                alt="Banner Eco Acesso - Transformando Sustentabilidade em Oportunidade" class="header-banner"
                onerror="this.onerror=null;this.src='https://placehold.co/900x200/2e7d32/ffffff?text=Eco+Acesso+Banner'">
        </header>

        <div class="page-title">
            <h1>Junte-se à Nossa Comunidade</h1>
            <p>Cadastre-se e faça parte da mudança por um planeta mais sustentável</p>
        </div>

        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress" id="progress-bar"></div>
            </div>
            <div class="progress-text" id="progress-text">0% completo</div>
        </div>

        <div class="message success" id="success-message" style="display: none;">
            <strong><i class="fas fa-check-circle"></i> Cadastro realizado com sucesso!</strong><br>
            Sua conta foi ativada. Você será redirecionado em breve.
        </div>

        <div class="message error" id="error-message" style="display: none;">
            <strong><i class="fas fa-exclamation-circle"></i> Erro no cadastro!</strong><br>
            <span id="error-details"></span>
        </div>

        <div class="form-wrapper">
            <form id="cadastro-form">
                <div class="form-columns">
                    <div class="form-column">
                        <div class="form-section">
                            <h3><i class="fas fa-user"></i> Informações Pessoais</h3>

                            <div class="form-group">
                                <label for="nome" class="required">Nome Completo</label>
                                <input type="text" id="nome" name="nome" required placeholder="Seu nome completo">
                                <div class="error-message" id="nome-error">Por favor, insira seu nome completo.</div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="email" class="required">E-mail</label>
                                    <input type="email" id="email" name="email" required placeholder="seu@email.com">
                                    <div class="error-message" id="email-error">Por favor, insira um e-mail válido.</div>
                                </div>

                                <div class="form-group">
                                    <label for="telefone" class="required">Telefone</label>
                                    <input type="tel" id="telefone" name="telefone" required
                                        placeholder="(11) 99999-9999">
                                    <div class="error-message" id="telefone-error">Por favor, insira um telefone válido.
                                    </div>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="data-nascimento" class="required">Data de Nascimento</label>
                                    <input type="date" id="data-nascimento" name="data-nascimento">
                                </div>

                                <div class="form-group">
                                    <label for="cpf" class="required">CPF</label>
                                    <input type="text" id="cpf" name="cpf" placeholder="000.000.000-00">
                                    <div class="error-message" id="cpf-error">Por favor, insira um CPF válido.</div>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3><i class="fas fa-lock"></i> Segurança</h3>

                            <div class="form-group">
                                <label for="senha" class="required">Senha</label>
                                <input type="password" id="senha" name="senha" required
                                    placeholder="Mínimo 6 caracteres">
                                <div class="error-message" id="senha-error">A senha deve ter no mínimo 6 caracteres.
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="confirmar-senha" class="required">Confirmar Senha</label>
                                <input type="password" id="confirmar-senha" name="confirmar-senha" required
                                    placeholder="Digite a senha novamente">
                                <div class="error-message" id="confirmar-senha-error">As senhas não coincidem.</div>
                            </div>
                        </div>
                    </div>

                    <div class="form-column">
                        <div class="form-section">
                            <h3><i class="fas fa-map-marker-alt"></i> Endereço</h3>

                            <div class="form-group">
                                <label for="cep">CEP</label>
                                <input type="text" id="cep" name="cep" placeholder="00000-000" maxlength="9">
                                <div class="cep-loading" id="cep-loading"></div>
                                <i class="fas fa-check cep-valid" id="cep-valid"></i>
                                <div class="error-message" id="cep-error">CEP inválido ou não encontrado.</div>
                            </div>

                            <div class="form-group">
                                <label for="logradouro">Logradouro</label>
                                <input type="text" id="logradouro" name="logradouro" placeholder="Rua, Avenida, etc."
                                    disabled>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="numero">Número</label>
                                    <input type="text" id="numero" name="numero" placeholder="123">
                                </div>

                                <div class="form-group">
                                    <label for="complemento">Complemento</label>
                                    <input type="text" id="complemento" name="complemento"
                                        placeholder="Apto, Bloco, etc.">
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="bairro">Bairro</label>
                                <input type="text" id="bairro" name="bairro" placeholder="Seu bairro" disabled>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="cidade">Cidade</label>
                                    <input type="text" id="cidade" name="cidade" placeholder="Sua cidade" disabled>
                                </div>

                                <div class="form-group">
                                    <label for="estado">Estado</label>
                                    <select id="estado" name="estado" disabled>
                                        <option value="">Selecione seu estado</option>
                                        <option value="AC">Acre</option>
                                        <option value="AL">Alagoas</option>
                                        <option value="AP">Amapá</option>
                                        <option value="AM">Amazonas</option>
                                        <option value="BA">Bahia</option>
                                        <option value="CE">Ceará</option>
                                        <option value="DF">Distrito Federal</option>
                                        <option value="ES">Espírito Santo</option>
                                        <option value="GO">Goiás</option>
                                        <option value="MA">Maranhão</option>
                                        <option value="MT">Mato Grosso</option>
                                        <option value="MS">Mato Grosso do Sul</option>
                                        <option value="MG">Minas Gerais</option>
                                        <option value="PA">Pará</option>
                                        <option value="PB">Paraíba</option>
                                        <option value="PR">Paraná</option>
                                        <option value="PE">Pernambuco</option>
                                        <option value="PI">Piauí</option>
                                        <option value="RJ">Rio de Janeiro</option>
                                        <option value="RN">Rio Grande do Norte</option>
                                        <option value="RS">Rio Grande do Sul</option>
                                        <option value="RO">Rondônia</option>
                                        <option value="RR">Roraima</option>
                                        <option value="SC">Santa Catarina</option>
                                        <option value="SP">São Paulo</option>
                                        <option value="SE">Sergipe</option>
                                        <option value="TO">Tocantins</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-file-contract"></i> Termos e Comunicação</h3>

                    <div class="checkbox-group">
                        <input type="checkbox" id="termos" name="termos" required>
                        <label for="termos" class="required">Aceito os Termos de Uso e Política de Privacidade</label>
                        <div class="error-message" id="termos-error">Você deve aceitar os termos para continuar.</div>
                    </div>
                </div>

                <button type="submit" id="submit-btn">
                    <span id="btn-text">Finalizar Cadastro</span>
                    <div class="loading" id="btn-loading" style="display: none;"></div>
                    <div class="success-checkmark" id="btn-success" style="display: none;"><i
                            class="fas fa-check-circle"></i></div>
                </button>
            </form>
        </div>

        <footer>
            <p>&copy; 2025 Eco Acesso - Todos os direitos reservados |
                <a href="politica.html" style="color: var(--branco); "> Política de Privacidade</a> |
                <a href="termos.html" style="color: var(--branco);">Termos de Uso</a>
            </p>
        </footer>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('cadastro-form');
        const submitBtn = document.getElementById('submit-btn');
        const btnText = document.getElementById('btn-text');
        const btnLoading = document.getElementById('btn-loading');
        const btnSuccess = document.getElementById('btn-success');
        const successMessage = document.getElementById('success-message');
        const errorMessage = document.getElementById('error-message');
        const errorDetails = document.getElementById('error-details');
        const allInputs = form.querySelectorAll('input, select');
        const cpfInput = document.getElementById('cpf');
        const telefoneInput = document.getElementById('telefone');

        // --- FUNÇÕES DE UTILIDADE ---

        // Função de máscara simples
        const formatField = (input, mask) => {
            let value = input.value.replace(/\D/g, '');
            let formatted = '';
            let maskIndex = 0;

            for (let i = 0; i < value.length; i++) {
                if (maskIndex >= mask.length) break;

                while (maskIndex < mask.length && mask[maskIndex] !== '0') {
                    formatted += mask[maskIndex];
                    maskIndex++;
                }

                if (maskIndex < mask.length) {
                    formatted += value[i];
                    maskIndex++;
                }
            }
            input.value = formatted;
        };

        // Função de validação de CPF (algoritmo básico)
        const isValidCPF = (cpf) => {
            cpf = cpf.replace(/[^\d]/g, '');
            if (cpf.length !== 11 || /^(\d)\1{10}$/.test(cpf)) return false;
            let sum = 0, remainder;

            for (let i = 1; i <= 9; i++) sum = sum + parseInt(cpf.substring(i - 1, i)) * (11 - i);
            remainder = (sum * 10) % 11;
            if ((remainder == 10) || (remainder == 11)) remainder = 0;
            if (remainder != parseInt(cpf.substring(9, 10))) return false;

            sum = 0;
            for (let i = 1; i <= 10; i++) sum = sum + parseInt(cpf.substring(i - 1, i)) * (12 - i);
            remainder = (sum * 10) % 11;
            if ((remainder == 10) || (remainder == 11)) remainder = 0;
            if (remainder != parseInt(cpf.substring(10, 11))) return false;

            return true;
        };

        // Função para calcular o progresso do formulário
        const updateProgress = () => {
            let completedFields = 0;
            let totalFields = 0;

            allInputs.forEach(input => {
                // Exclui campos desativados, de complemento e checkboxes de preferência (opcionais)
                if (input.disabled || input.name === 'complemento' || 
                    (input.type === 'checkbox' && input.name !== 'termos')) return;
                
                // Contagem de campos obrigatórios
                const isRequired = input.hasAttribute('required') || 
                                     input.closest('.form-group')?.querySelector('label')?.classList.contains('required');
                
                if (isRequired) {
                    totalFields++;
                    if (input.type === 'checkbox') {
                        if (input.checked) completedFields++;
                    } else if (input.value.trim() !== '') {
                        // Adiciona verificações específicas para CPF, Telefone e Senha (com 6+ caracteres)
                        let isFieldValid = true;
                        if (input.id === 'cpf' && !isValidCPF(input.value)) {
                            isFieldValid = false;
                        } else if (input.id === 'telefone' && input.value.replace(/\D/g, '').length < 10) {
                            isFieldValid = false;
                        } else if ((input.id === 'senha' || input.id === 'confirmar-senha') && input.value.length < 6) {
                            isFieldValid = false;
                        }
                        
                        if (isFieldValid) completedFields++;
                    }
                } else if (input.value.trim() !== '') {
                    // Conta campos opcionais preenchidos
                    completedFields++;
                }
            });

            // Adiciona os campos opcionais de endereço que são preenchidos pelo CEP
            const cepValido = document.getElementById('cep-valid')?.style.display !== 'none';
            if (cepValido) {
                completedFields += 4; // logradouro, bairro, cidade, estado (estimativa)
            }
            totalFields += 4; // Adiciona os campos de endereço opcionais na contagem total

            let percentage = Math.floor((completedFields / totalFields) * 100);
            percentage = Math.min(100, Math.max(0, percentage)); // Limita entre 0 e 100

            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');

            if (progressBar && progressText) {
                progressBar.style.width = percentage + '%';
                progressText.textContent = percentage + '% completo';
            }
        };


        // --- MÁSCARAS E EVENT LISTENERS ---

        // Máscaras de CPF, Telefone e CEP
        cpfInput.addEventListener('input', (e) => {
            formatField(e.target, '000.000.000-00');
            updateProgress();
        });

        telefoneInput.addEventListener('input', (e) => {
            const mask = e.target.value.replace(/\D/g, '').length <= 10 ? '(00) 0000-0000' : '(00) 00000-0000';
            formatField(e.target, mask);
            updateProgress();
        });

        document.getElementById('cep').addEventListener('input', (e) => {
            formatField(e.target, '00000-000');
            updateProgress();
        });

        // Validação contínua do progresso
        allInputs.forEach(input => {
            input.addEventListener('input', updateProgress);
            input.addEventListener('change', updateProgress);
        });


        // --- BUSCA CEP VIA VIACEP ---

        const cepInput = document.getElementById('cep');
        const cepLoading = document.getElementById('cep-loading');
        const cepValidIcon = document.getElementById('cep-valid');
        const logradouroInput = document.getElementById('logradouro');
        const bairroInput = document.getElementById('bairro');
        const cidadeInput = document.getElementById('cidade');
        const estadoSelect = document.getElementById('estado');
        const cepError = document.getElementById('cep-error');

        const clearAddressFields = (disable = true) => {
            logradouroInput.value = '';
            bairroInput.value = '';
            cidadeInput.value = '';
            estadoSelect.value = '';
            if (disable) {
                logradouroInput.disabled = true;
                bairroInput.disabled = true;
                cidadeInput.disabled = true;
                estadoSelect.disabled = true;
            }
        }

        const enableAddressFields = () => {
            logradouroInput.disabled = false;
            bairroInput.disabled = false;
            cidadeInput.disabled = false;
            estadoSelect.disabled = false;
        }

        cepInput.addEventListener('blur', async () => {
            const cep = cepInput.value.replace(/\D/g, '');
            cepValidIcon.style.display = 'none';
            cepInput.classList.remove('error');
            cepError.style.display = 'none';
            clearAddressFields();

            if (cep.length !== 8) return;

            cepLoading.style.display = 'block';

            try {
                const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
                const data = await response.json();

                cepLoading.style.display = 'none';

                if (data.erro) {
                    cepInput.classList.add('error');
                    cepError.textContent = 'CEP não encontrado.';
                    cepError.style.display = 'block';
                    clearAddressFields(false); // Mantém campos abertos para preenchimento manual
                    return;
                }

                // Preenche os campos
                logradouroInput.value = data.logradouro;
                bairroInput.value = data.bairro;
                cidadeInput.value = data.localidade;
                estadoSelect.value = data.uf;

                // Habilita campos caso o CEP seja válido
                enableAddressFields();
                cepValidIcon.style.display = 'block';
                updateProgress();

            } catch (error) {
                console.error('Erro ao buscar CEP:', error);
                cepLoading.style.display = 'none';
                cepInput.classList.add('error');
                cepError.textContent = 'Falha na comunicação com o serviço de CEP.';
                cepError.style.display = 'block';
            }
        });


        // --- VALIDAÇÃO GERAL E ENVIO DO FORMULÁRIO ---

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            // Esconde mensagens antigas
            successMessage.style.display = 'none';
            errorMessage.style.display = 'none';
            errorDetails.textContent = '';
            let formValid = true;
            let firstInvalidInput = null;

            // Limpa erros visuais anteriores
            allInputs.forEach(input => {
                input.classList.remove('error');
                const errorMsg = document.getElementById(`${input.id}-error`);
                if (errorMsg) errorMsg.style.display = 'none';
            });


            // 1. Validação dos Campos de Texto e Seleção
            allInputs.forEach(input => {
                const errorMsg = document.getElementById(`${input.id}-error`);
                const isRequired = input.hasAttribute('required') || 
                                     input.closest('.form-group')?.querySelector('label')?.classList.contains('required');

                if (isRequired) {
                    if (input.type === 'checkbox') {
                        if (!input.checked) {
                            input.classList.add('error');
                            if (errorMsg) errorMsg.style.display = 'block';
                            formValid = false;
                            if (!firstInvalidInput) firstInvalidInput = input;
                        }
                    } else if (input.value.trim() === '') {
                        input.classList.add('error');
                        if (errorMsg) errorMsg.style.display = 'block';
                        formValid = false;
                        if (!firstInvalidInput) firstInvalidInput = input;
                    }
                }
            });

            // 2. Validações Específicas
            const emailInput = document.getElementById('email');
            const senhaInput = document.getElementById('senha');
            const confirmarSenhaInput = document.getElementById('confirmar-senha');
            
            // Validação de E-mail (Regex Simples)
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (emailInput.value.trim() !== '' && !emailRegex.test(emailInput.value)) {
                emailInput.classList.add('error');
                document.getElementById('email-error').style.display = 'block';
                formValid = false;
                if (!firstInvalidInput) firstInvalidInput = emailInput;
            }

            // Validação de CPF
            if (cpfInput.value.trim() !== '' && !isValidCPF(cpfInput.value)) {
                cpfInput.classList.add('error');
                document.getElementById('cpf-error').style.display = 'block';
                formValid = false;
                if (!firstInvalidInput) firstInvalidInput = cpfInput;
            }

            // Validação de Senha (Comprimento Mínimo)
            if (senhaInput.value.length < 6) {
                senhaInput.classList.add('error');
                document.getElementById('senha-error').textContent = 'A senha deve ter no mínimo 6 caracteres.';
                document.getElementById('senha-error').style.display = 'block';
                formValid = false;
                if (!firstInvalidInput) firstInvalidInput = senhaInput;
            }

            // Validação de Confirmação de Senha
            if (senhaInput.value !== confirmarSenhaInput.value) {
                confirmarSenhaInput.classList.add('error');
                document.getElementById('confirmar-senha-error').style.display = 'block';
                formValid = false;
                if (!firstInvalidInput) firstInvalidInput = confirmarSenhaInput;
            }

            if (!formValid) {
                errorMessage.style.display = 'block';
                errorDetails.textContent = 'Por favor, corrija os campos destacados.';
                if (firstInvalidInput) firstInvalidInput.focus();
                return;
            }


            // --- ENVIO DOS DADOS (FETCH API) - CORRIGIDO ---

            // Prepara o botão para envio
            submitBtn.disabled = true;
            btnText.textContent = 'Enviando...';
            btnLoading.style.display = 'inline-block';
            btnSuccess.style.display = 'none';

            // Coleta os dados do formulário
            const formData = new FormData(form);
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                
                // 1. Trata Checkboxes
                if (form.elements[key]?.type === 'checkbox') {
                    // Se a chave existir no FormData, ela está marcada (true).
                    // As não marcadas serão adicionadas abaixo.
                    data[key] = true;
                } 
                // 2. Trata Campos de Texto (limpa máscaras de CPF/Telefone)
                else {
                    let cleanValue = value.trim();
                    if (key === 'cpf' || key === 'telefone' || key === 'cep') {
                        cleanValue = cleanValue.replace(/\D/g, ''); // Remove todos os não-dígitos
                    }
                    data[key] = cleanValue;
                }
            }
            
            // 3. Adiciona explicitamente as checkboxes não marcadas como 'false'
            // Isso garante que o campo 'termos' (obrigatório) seja enviado, mesmo que desmarcado (caindo na validação do 400 da API, se o usuário burlar a validação do front)
            // Também garente que newsletter/eventos sejam enviados como false se não marcados.
            form.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                if (!data.hasOwnProperty(checkbox.name)) {
                    data[checkbox.name] = false;
                }
            });


            // Remove a confirmação de senha antes de enviar para o backend
            delete data['confirmar-senha'];

            // CORREÇÃO: REMAPEIA OS CAMPOS PARA O FORMATO ESPERADO PELA API
            const apiData = {
                nome: data.nome || '',
                email: data.email || '',
                telefone: data.telefone || '',
                data_nascimento: data['data-nascimento'] || '', // Mapeia de data-nascimento para data_nascimento
                cpf: data.cpf || '',
                senha: data.senha || '',
                cep: data.cep || '',
                logradouro: data.logradouro || '',
                numero: data.numero || '',
                complemento: data.complemento || '',
                bairro: data.bairro || '',
                cidade: data.cidade || '',
                estado: data.estado || '',
                termos_aceitos: data.termos || false // Mapeia de termos para termos_aceitos
            };

            try {
                // Endpoint para a sua Serverless Function no Vercel
                const response = await fetch('/api/cadastrar', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(apiData) // Envia o objeto REMAPEADO
                });

                // Verifica se a resposta foi bem-sucedida (status 2xx)
                if (response.ok) {
                    const result = await response.json();
                    
                    // Exibe sucesso
                    btnLoading.style.display = 'none';
                    btnText.textContent = 'Sucesso!';
                    btnSuccess.style.display = 'inline-block';
                    successMessage.style.display = 'block';
                    
                    // Redireciona após um pequeno atraso
                    setTimeout(() => {
                        window.location.href = '/'; // Redireciona para a página principal
                    }, 2000);

                } else {
                    // Trata erros do servidor (4xx, 5xx)
                    const errorData = await response.json();
                    
                    // Lança um erro com a mensagem detalhada do backend
                    throw new Error(errorData.error || `Erro no servidor: Status ${response.status}`);
                }

            } catch (error) {
                // Exibe mensagem de erro
                console.error('Erro ao cadastrar:', error.message);
                
                btnLoading.style.display = 'none';
                btnText.textContent = 'Tentar Novamente';
                btnSuccess.style.display = 'none';
                submitBtn.disabled = false;
                
                errorMessage.style.display = 'block';
                errorDetails.textContent = error.message || 'Ocorreu um erro desconhecido durante o envio. Tente novamente.';
            }
        });

        // Inicializa a barra de progresso
        updateProgress();
    });
</script>
</body>

</html>